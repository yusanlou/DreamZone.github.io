<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS 国际化全解-swift与OC | 梦の碎片</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="#前言

iOS国际化是个很头疼的问题，尤其是项目更新了N个版本突然要加入国际化需求的时候。（大部分都是这样吧…）




（吐槽结束）那么开始吧

###首先项目的国际化分为 代码部分 和 StoryBoard部分

先生成Localizable.strings文件   【比较简单】

#代码部分

需要对代码中的中文可视的字符串进行国际化，这是一件苦力活！



123456789101112">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 国际化全解-swift与OC">
<meta property="og:url" content="http://yoursite.com/2017/03/22/localizationCommand/index.html">
<meta property="og:site_name" content="梦の碎片">
<meta property="og:description" content="#前言

iOS国际化是个很头疼的问题，尤其是项目更新了N个版本突然要加入国际化需求的时候。（大部分都是这样吧…）




（吐槽结束）那么开始吧

###首先项目的国际化分为 代码部分 和 StoryBoard部分

先生成Localizable.strings文件   【比较简单】

#代码部分

需要对代码中的中文可视的字符串进行国际化，这是一件苦力活！



123456789101112">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-4b594a7d61a08e32.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-fb76d843d45a78a7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-1c1024f72b7d6641.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-ed3ff2a1622aa483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-a3dcb18fbab7aa7c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-ecdb3a537293e5d3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-49f3d261828395bf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-28cfc7bea649debb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1423951-0c460f519e62a485.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-03-23T03:35:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS 国际化全解-swift与OC">
<meta name="twitter:description" content="#前言

iOS国际化是个很头疼的问题，尤其是项目更新了N个版本突然要加入国际化需求的时候。（大部分都是这样吧…）




（吐槽结束）那么开始吧

###首先项目的国际化分为 代码部分 和 StoryBoard部分

先生成Localizable.strings文件   【比较简单】

#代码部分

需要对代码中的中文可视的字符串进行国际化，这是一件苦力活！



123456789101112">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1423951-4b594a7d61a08e32.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  
    <link rel="alternate" href="/atom.xml" title="梦の碎片" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">梦の碎片</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-localizationCommand" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/22/localizationCommand/" class="article-date">
  <time datetime="2017-03-22T05:56:45.000Z" itemprop="datePublished">2017-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS 国际化全解-swift与OC
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#前言</p>
<blockquote>
<p>iOS国际化是个很头疼的问题，尤其是项目更新了N个版本突然要加入国际化需求的时候。（大部分都是这样吧…）</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1423951-4b594a7d61a08e32.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<hr>
<blockquote>
<p>（吐槽结束）那么开始吧</p>
</blockquote>
<p>###首先项目的国际化分为 <em>代码部分</em> 和 <em>StoryBoard部分</em></p>
<hr>
<p><a href="http://jingyan.baidu.com/article/0202781178f19e1bcc9ce5d7.html" target="_blank" rel="external">先生成Localizable.strings文件</a>   【比较简单】</p>
<ul>
<li><p>#代码部分</p>
<ul>
<li>需要对代码中的中文可视的字符串进行国际化，这是一件苦力活！</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"> // swift </div><div class="line"> NSLocalizedString(&quot;str&quot;, comment: &quot;字符串&quot;)</div><div class="line"> // OC</div><div class="line"> NSLocalizedString(@&quot;str&quot;, &quot;字符串&quot;)</div><div class="line"></div><div class="line">第一个参数： 原来的字符串</div><div class="line">第二个参数： 字符串的注解</div><div class="line"></div><div class="line">这里需要注意的是</div><div class="line">1、尽量不要为了方便书写自定义宏或者封装【会对批量生成命令产生影响，后面会讲到】</div><div class="line">2、参数不支持变量！【单纯的字符串就好】</div><div class="line">3、参数是支持中文的（不过时间充裕的话最好是前面换成英文标示，后面写上中文注解）</div><div class="line">  NSLocalizedString(&quot;example&quot;, comment: &quot;例子&quot;)</div></pre></td></tr></table></figure>
<hr>
<p>###代码处理</p>
<ul>
<li>然而如此多的字符串要怎么替换呢？<blockquote>
<p>这时候可以用xcode强大的查找替换功能！</p>
</blockquote>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1423951-fb76d843d45a78a7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>然后需要这两个正则：<br>swift<br><code>(&quot;[^\x00-\xff]+&quot;)</code><br><code>NSLocalizedString($1, comment: &quot;&quot;))</code><br>OC<br><code>(@&quot;[^\x00-\xff]+&quot;)</code><br><code>NSLocalizedString($1, comment: &quot;&quot;)</code></p>
<p>这个正则是查找所有中文编码的字符串，当然肯定会漏掉一些中文和英文字符混合的字符串 ，然后我不会这种正则 orz </p>
<blockquote>
<p>0_0！</p>
</blockquote>
<p>好在项目里这种字符串不太多，这里还需要注意，不要手贱把图片啥的也替换了 😂</p>
<h2 id="如果对python等脚本语言熟悉的话可以写个脚本，全自动完成"><a href="#如果对python等脚本语言熟悉的话可以写个脚本，全自动完成" class="headerlink" title="####如果对python等脚本语言熟悉的话可以写个脚本，全自动完成"></a>####如果对python等脚本语言熟悉的话可以写个脚本，全自动完成</h2><ul>
<li>字符串都替换完之后<br>接下来进行至关重要的一步，也很简单<br>打开终端工具，cd到项目的根目录,然后看下【先不要运行】下面这个命令:<br><code>$ find ./ -name *.m -print0 | xargs -0 genstrings -o en.lproj</code></li>
</ul>
<p>这个命令会找到项目里所有的.m文件列表，然后xargs会分步执行<a href="http://www.cnblogs.com/U-tansuo/p/IOS_NSLocalizedString.html" target="_blank" rel="external">genstrings</a>命令<br>-o 表示将结果直接输出到后面的文件目录中,且直接覆盖。</p>
<p>后续的迭代开发中可以用这个命令替代，自动追加:<br><code>$ find ./ -name *.m -print0 | xargs -0 genstrings -o en.lproj</code></p>
<p>这个en.lproj表示输出到Localizable.strings(English)文件中【英文文版本】</p>
<p><code>$ find ./ -name *.m -print0 | xargs -0 genstrings -o zh-Hans.lproj</code><br>这个en.lproj表示输出到Localizable.strings(Simplified)文件【中文版本】</p>
<p>以上是OC文件的处理,swift需要对命令稍微修改一下：<br><code>$ find ./ -name &quot;*.swift&quot; | xargs genstrings -o en.lproj</code></p>
<blockquote>
<p>这里需要注意，如果项目里有对NSLocalizedString函数的封装，或者宏定义，命令会报错，且定位错误，直接暂时删掉就好了，以后可以在加上</p>
</blockquote>
<p>做完这些打开项目里的Localizable.strings，就会发现项目里需要翻译的字符串都在里面了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">/* No comment provided by engineer. */</div><div class="line">&quot;喜欢&quot; = &quot;Like&quot;;</div></pre></td></tr></table></figure></p>
<p>注释里是注解，因为我滞空了，所以提示“No comment provided by engineer”</p>
<p>接下来直接把English中的直接给翻译人员，坐等翻译……</p>
<p><strong>需要注意的是注释可以不要，但是 “喜欢” = “Like”;  格式一定要对，字符串 = 字符串 分号 。如果万一弄错了，错误很难发现。*</strong></p>
<p><strong>xcode高兴了给你的格式错误的提示【但是定位不到哪一行，我们项目两千多行。。。】，但很多情况下，xcode不报错，但是国际化直接失效或者部分失效，不多说了，找了三天的很肝疼……</strong></p>
<p>以上就是代码部分的，写的比较匆忙，欢迎指正错误  O(∩_∩)O~</p>
<hr>
<h2 id="接下来是storyboard部分"><a href="#接下来是storyboard部分" class="headerlink" title="接下来是storyboard部分"></a>接下来是storyboard部分</h2><p><img src="http://upload-images.jianshu.io/upload_images/1423951-1c1024f72b7d6641.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>比起代码，storyboard要稍微复杂一点，不过难度也不大。</p>
<p>这里我大部分参考的<a href="http://www.cnblogs.com/levilinxi/p/4296712.html" target="_blank" rel="external">这篇文章</a></p>
<p>前辈写的很好，但是对于脚本部分所述不详，而且使用过程中也有些问题。</p>
<p>storyboard基本国际化非常简单</p>
<ul>
<li><p>第一步：设置需要的语音<br><img src="http://upload-images.jianshu.io/upload_images/1423951-ed3ff2a1622aa483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li><p>第二步：打钩<br><img src="http://upload-images.jianshu.io/upload_images/1423951-a3dcb18fbab7aa7c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
</li>
<li><p>完成。</p>
</li>
</ul>
<blockquote>
<p> 然后这只能满足一次开发，在后续迭代storyboard中的内容会越来越多，可悲剧的是storyboard不会自动同步内容到 storyboard.strings 中！</p>
</blockquote>
<p><strong>所以我们需要一个脚本，来帮我们同步</strong></p>
<ul>
<li>而脚本需要做的就是执行这个命令：<br><code>$ ibtool Main.storyboard --generate-strings-file ./NewTemp.string</code></li>
</ul>
<p><a href="https://github.com/linyu92/MyGitHub/tree/master/LyAutoGenStrings/LyAutoGenStrings/RunScript" target="_blank" rel="external">我是脚本</a></p>
<ul>
<li>先把下载下来的脚本放到文件的项目目录<br><code>ProjectName/RunScript/AutoGenStrings.py</code></li>
<li>然后target-Build Phases<br><img src="http://upload-images.jianshu.io/upload_images/1423951-ecdb3a537293e5d3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>添加一个执行脚本的命令<br><img src="http://upload-images.jianshu.io/upload_images/1423951-49f3d261828395bf.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>到这里基本上就完成了，测试的时候可以把Run script only when installing 的勾取消【只在打包的时候运行】<br>这样每次bulid都会执行脚本。</li>
</ul>
<p><code>python ${SRCROOT}/${TARGET_NAME}/RunScript/AutoGenStrings.py ${SRCROOT}/${TARGET_NAME}/StoryBoard</code></p>
<ul>
<li>这里需要注意的是<br><code>${SRCROOT}/${TARGET_NAME}/RunScript/AutoGenStrings</code>是运行语句，后面是参数，这个参数会在py脚本里起很重要的作用！</li>
</ul>
<blockquote>
<p>但是运行一次发现，脚本没有运行，或者报错</p>
</blockquote>
<p><strong>这里我们就需要对脚本进行分析了。</strong></p>
<ul>
<li>先看这几个参数：<br><img src="http://upload-images.jianshu.io/upload_images/1423951-28cfc7bea649debb.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></li>
</ul>
<p>Base.lproj/*.stroyboard ——  Base.lproj目录下所有的storyboard文件<br>kTargetFile —— *.stirngs文件</p>
<p>KGenerateStringFile —— 不管他(🙄)</p>
<p>ColonRegex —— 正则 匹配字符串的</p>
<p>KeyParamRegex —— 正则 匹配 “喜欢” = “Like”; 格式的</p>
<p>AnotationRegexPrefix —— 匹配注释/*   */ 【修改了一下源码】</p>
<ul>
<li>我们先说第一个问题<br>glob 遍历文件的问题，<a href="http://www.cnblogs.com/hongten/p/hongten_python_glob.html" target="_blank" rel="external">glob</a>是一个python模板，用于查找匹配的文件的</li>
</ul>
<p>然后我们来看mian函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$python</div><div class="line">filePath = sys.argv[1]</div><div class="line">	sourceFilePath = filePath + &apos;/&apos; + KSourceFile </div><div class="line">	sourceFile_list = glob.glob(sourceFilePath)</div></pre></td></tr></table></figure></p>
<p>这里的filePath就是我们在xcode的RunScript中的写的参数 这里等同于<br><code>~/StoryBoard/Base.lproj/*.storyboard</code><br>看一下自己项目的stroyBoard目录【我们项目的storyboard都放在了storyboard这个group中】</p>
<ul>
<li>一般都是这样的：<br><img src="http://upload-images.jianshu.io/upload_images/1423951-0c460f519e62a485.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br>storyboard就存在Base.lproj文件夹中</li>
</ul>
<p><strong>所以这里的参数需要注意，一定要填对</strong></p>
<ul>
<li>接下来我们看第二个问题：<br>如果在storyboard目录下，有子文件夹，里面分别存放着不同的storyboard，那么就会出现storyboard遍历不到的问题！<br>因为对python不熟，所以我的方法暂时是这样的：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$python</div><div class="line">sourceFilePath = filePath + &apos;/*/&apos; + KSourceFile</div><div class="line">	onesourceFilePath =  filePath + &apos;/&apos; + KSourceFile</div><div class="line">	sourceFile_list = glob.glob(sourceFilePath)</div><div class="line">	onesourceFile_list = glob.glob(onesourceFilePath)</div><div class="line">	for source in onesourceFile_list:</div><div class="line">		sourceFile_list.append(source)</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>因为我们项目里这有两层目录有storyboard，所以这里只是简单的拼接了一下，小伙伴们可以写个遍历函数，这里就不献丑了😂</p>
</blockquote>
<p>这样第二个问题就解决了~</p>
<ul>
<li>目前发现的最后一个问题：<br>出现在getAnotationOfString函数里，脚本一直崩溃于re.search(anotationRegex,string_txt)<br>这是个简单的正则查找的函数，报错的缘由是因为正则语句的问题。<br>经过一番排查发现是storyboard中有特殊字符 “*” <blockquote>
<p>坑！</p>
</blockquote>
</li>
</ul>
<p>我们需要对它进行转义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def constructAnotationRegex(str):   </div><div class="line">#对*进行处理   </div><div class="line">newStr = str.replace(&quot;*&quot;,&quot;\*&quot;)   </div><div class="line">return AnotationRegexPrefix + &apos;\n&apos; + newStr</div></pre></td></tr></table></figure></p>
<p>修改完这个函数，基本上就搞定了！</p>
<p>最新命令行工具，一个命令搞定swift，objc文件的国际化:<br>star: <a href="https://github.com/BackNotGod/localizationCommand" target="_blank" rel="external">https://github.com/BackNotGod/localizationCommand</a><br>运行，搞定！<br>欢迎拍砖！😂</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/22/localizationCommand/" data-id="cj0lxrux70000ww39x5d8doxe" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/22/localizationCommand/">iOS 国际化全解-swift与OC</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 BackNotGod<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>